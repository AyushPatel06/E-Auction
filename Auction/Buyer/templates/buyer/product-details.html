{% extends 'base.html' %}
{% load static %}
{% block content %}

<style>
	.panel {
    border: none;
    box-shadow: none;
}

.panel-heading {
    border-color:#eff2f7 ;
    font-size: 16px;
    font-weight: 300;
}

.panel-title {
    color: #2A3542;
    font-size: 14px;
    font-weight: 400;
    margin-bottom: 0;
    margin-top: 0;
    font-family: 'Open Sans', sans-serif;
}

/*product list*/

.pane1 {
	width: 450px;
	height: auto;
}

li img {
  border-left: solid 1px #e2eaef;
  border-right: solid 1px #e2eaef;
}

.preview {
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
  -webkit-flex-direction: column;
      -ms-flex-direction: column;
          flex-direction: column; }
  @media screen and (max-width: 996px) {
    .preview {
      margin-bottom: 20px; } 
    .pane1 {
    	width: 100%
    }
  }

.preview-pic {
  -webkit-box-flex: 1;
  -webkit-flex-grow: 1;
      -ms-flex-positive: 1;
          flex-grow: 1; }

.preview-thumbnail.nav-tabs {
  border: none;
  margin-top: 15px; }
  .preview-thumbnail.nav-tabs li {
    width: 13%;
    margin-right: 2.5%; }
    .preview-thumbnail.nav-tabs li img {
      max-width: 100%;
      display: block; }
    .preview-thumbnail.nav-tabs li a {
      padding: 0;
      margin: 0; }
    .preview-thumbnail.nav-tabs li:last-of-type {
      margin-right: 0; }

.tab-content {
  overflow: hidden; }
  .tab-content img {
    width: 100%;
    -webkit-animation-name: opacity;
            animation-name: opacity;
    -webkit-animation-duration: .3s;
            animation-duration: .3s; }

.card {
  margin-top: 10px;
  background: #fff;
  padding: 2em;
  line-height: 1.5em; }

@media screen and (min-width: 997px) {
  .wrapper {
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex; } }

.details {
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
  -webkit-flex-direction: column;
      -ms-flex-direction: column;
          flex-direction: column; }

.colors {
  -webkit-box-flex: 1;
  -webkit-flex-grow: 1;
      -ms-flex-positive: 1;
          flex-grow: 1; }

.product-title, .price, .sizes, .colors {
  text-transform: UPPERCASE;
  font-weight: normal; }

.checked, .price span {
  color: #be2714; }

.product-title, .rating, .product-description, .price, .vote, .sizes {
  margin-bottom: 15px; }

.product-title {
  margin-top: 0; }

.size {
  margin-right: 10px; }
  .size:first-of-type {
    margin-left: 40px; }


@-webkit-keyframes opacity {
  0% {
    opacity: 0;
    -webkit-transform: scale(3);
            transform: scale(3); }
  100% {
    opacity: 1;
    -webkit-transform: scale(1);
            transform: scale(1); } }

@keyframes opacity {
  0% {
    opacity: 0;
    -webkit-transform: scale(3);
            transform: scale(3); }
  100% {
    opacity: 1;
    -webkit-transform: scale(1);
            transform: scale(1); } }
#gallery li {
display: inline;
margin-right: 3px;
}
#gallery #main-img {
background: url(https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885__340.jpg) no-repeat 0 0;

}

#more {display: none;}
ul.thumb{
  margin:0 auto;
  padding: 0;
  float: left;
}
ul.thumb li{
  list-style: none;
  margin: 10px;
}
ul.thumb li img{
  width: 80px;
  height: 80px;
  border: 1px solid grey;
}
.table-striped > tbody > tr:nth-child(odd) > td, .table-striped > tbody > tr:nth-child(odd) > thead > th {
   background-color: #375275;
   color: white;
}
.table-striped > tbody > tr:nth-child(even) > td, .table-striped > tbody > tr:nth-child(even) > thead > th {
   background-color: whitesmoke;
   color: #012657;
}

</style>
<script type="text/javascript">
    
	$(document).ready(function() {
		// Image swap on hover
		$("#gallery li img").hover(function(){
			$('#main-img').attr('src',$(this).attr('src').replace('thumb/', ''));
		});
		// Image preload
		var imgSwap = [];
		 $("#gallery li img").each(function(){
			imgUrl = this.src.replace('thumb/', '');
			imgSwap.push(imgUrl);
		});
		$(imgSwap).preload();
	});
	$.fn.preload = function() {
		this.each(function(){
			$('<img/>')[0].src = this;
		});
	}
	 
	
	</script>

<div class="container" style="margin-top: 100px;">
	<section class="panel">
		<div class="row py-5">
				<div id="gallery">
					<div class="preview-pic tab-content">
					  <div class="tab-pane pane1 active" style="height: 400px; width: auto; display: flex;"><img src="{{product.image1.url}}"  alt="" id="main-img" style="max-height: 100%; max-width:100%; width: auto; margin: auto" /></div>
					
					</div>
					<ul class="preview-thumbnail nav nav-tabs">
					  <li class="active"><img src="{{product.image1.url}}" /></li>
					  {% if product.image2 %}
					  <li><img src="{{product.image2.url}}" /></li>
					  {% endif %}
					  {% if product.image3 %}
					  <li><img src="{{product.image3.url}}" /></li>
					  {% endif %}
					  {% if product.image4 %}
					  <li><img src="{{product.image4.url}}" /></li>
					  {% endif %}
					  {% if product.image5 %}
					  <li><img src="{{product.image5.url}}" /></li>
					  {% endif %}
					  {% if product.image6 %}
					  <li><img src="{{product.image6.url}}" /></li>
					  {% endif %}
					</ul>	
				</div>						
			</div>
			  <div class="row py-5">
				  <h4 class="pro-d-title" style="color: #012657;">
						{{product.product_name}}
				  </h4>
                  <strong style="color: #012657;">Starting Bid Price </strong> <span class="amount-old" style="color: #012657;"><span><i class="fa-sharp fa-solid fa-dollar-sign fa-beat" aria-hidden="true" style="color: #012657;"></i>&nbsp;</span>{{product.price}}</span>
				  <div class="m-bot15 py-2" style="font-size: medium;"> 
            <div class="row">
                    <div class="col-3 fs-5">
                        <strong style="color: green;">Current Bid Price : &nbsp; </strong> <span class="amount-old btn-shine" style="color: #012657; font-weight: bolder;"><span><i class="fa-sharp fa-solid fa-dollar-sign fa-beat" aria-hidden="true"></i>&nbsp;</span>{{value}}</span>
                    </div>
                    <div class="col-4" id="sucbtn" style="display: none;"> 
                      <a href="{% url 'Buyer:index' %}checkout/{{product.product_id}}" class="btn btn-primary btn-lg align-items-center text-white">Procced for Payment</a>
                     </div>
                     <div class="col-4" id="backbtn" style="display: none;">
                      <a href="{% url 'Buyer:index' %}" class="btn btn-danger btn-lg align-items-center text-white">Back To Home</a>
                     </div>
                    </div>
                    <div id="timeout" class="circle" style="color: red; font-size: medium;">
                      {{t}}
                    </div>
                    </div>
                       <div class="pb-2" id="msg1" style="display: none;color: #012657; font-size: large;">Congratulations! <i class="fa-solid fa-champagne-glasses" style="color: #012657;"></i> {{winner}} is win the auction with bid value <i class="fa-sharp fa-solid fa-dollar-sign fa-beat" aria-hidden="true"></i> {{ winbid }}.....</div>
                       {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
						<hr>
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="py-3" style="overflow-y: scroll; height:100px;">
                                {% for bid in bids %}
                                <div class="text-center pb-3" style="color: #012657;">{{ bid.user.username }} bid <strong><i class="fa-sharp fa-solid fa-dollar-sign fa-beat" aria-hidden="true"></i> {{ bid.current_bid }}</strong> at
                                    {{ bid.bid_date|date:'M d, h:i a' }}</div>
                                {% endfor %}   
                                </div>                         
                            <form method="post" action="" id="form2" >
                                {% csrf_token %}
                                <div class="justify-content-center align-items-center input-group">
                                    <div class="form-outline">
                                      <input type="search" name="Bid" id="form1" class="form-control" style="width: 350px;"/>
                                      <label class="form-label" for="form1" style="color: #012657;">Bid</label>
                                    </div>
                                    <div>
                                    <button type="submit" id="btn1" class="btn" style="background-color: #012657; color: white; ">
                                      Bid Now
                                    </button>
                                    </div>
                                  </div>
                            </form>
                            </div>
                            <div class="col-lg-4 ">
                                <div class="mb-3" >
                                    <h6 class="title d-flex justify-content-center fs-5" style="color: #012657;">This Auction Ends in:</h6>
                                    <div class="countdown d-flex justify-content-center fs-4 text-danger">
                                        <div id="bid_counter1"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="container py-3">
                            <ul class="nav nav-tabs nav-fill mb-3" id="ex1" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link active" id="ex2-tab-1" data-mdb-toggle="tab" href="#ex2-tabs-1" role="tab" aria-controls="ex2-tabs-1" aria-selected="true" >
                                            <img class='thumb' src="{% static 'image/tab3.png' %}" alt="product">
                                            Description
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="ex2-tab-2" data-mdb-toggle="tab" href="#ex2-tabs-2" role="tab" aria-controls="ex2-tabs-2" aria-selected="false" >
                                    <img class='thumb' src="{% static 'image/tab2.png' %}" alt="product">
                                            Delivery options
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="ex2-tab-3" data-mdb-toggle="tab" href="#ex2-tabs-3" role="tab" aria-controls="ex2-tabs-3" aria-selected="false">
                                    <img class='thumb' src="{% static 'image/tab3.png' %}" alt="product">
                                        Bid History
                                    </a>
                                </li>
                            </ul>
                                
                            <div class="tab-content" id="ex2-content">
                                <div class="tab-pane fade show active" id="ex2-tabs-1" role="tabpanel" aria-labelledby="ex2-tab-1">
                                    <p class="py-3">
                                        {{product.description}}
                                        </p>
                                </div>
                                <div class="tab-pane fade" id="ex2-tabs-2" role="tabpanel" aria-labelledby="ex2-tab-2">
                                    Tab 3 content
                                </div>
                                <div class="tab-pane fade" id="ex2-tabs-3" role="tabpanel" aria-labelledby="ex2-tab-3">
                                    <div class="row d-flex justify-content-center align-items-center h-100">
                                        <div class="col">
                                            <div class="card card-registration my-4" style="overflow-y: scroll; height: 500px;">
                                                <table class="table table-striped table-hove">
                                                    <thead class="fs-4 fw-bold" style="color: #012657;">
                                                        <tr>
                                                        <th scope="col">Bidder</th>
                                                        <th scope="col">Bid price</th>
                                                        <th scope="col">Bidding Time & Date</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for bid in bids %}
                                                                    <tr>
                                                                        <td>{{ bid.user.username }}</td>
                                                                        <td> {{ bid.current_bid }}</td>
                                                                        <td>{{ bid.bid_date|date:'M d, h:i a' }}</td>
                                                                    </tr>
                                                                    {% endfor %}
                                                                    
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        </div>
                </div>
                            </div>
			            </div>
			</div>
	  </section>
	  </div>
	
    <script>
      //document.getElementById('msg').style.display='None';
      var auctimer = "{{ bd.bid_date|date:'Y-m-d H:i' }}"
       var at = new Date(auctimer).getTime();
       var addtime =new Date(at + 2*60*1000);
       var now = new Date()
       //console.log(addtime)
      
       if(addtime){
        setInterval(function(){
         var timeleft = 10;
        var downloadTimer = setInterval(function(){
     if(timeleft <= 0){
       clearInterval(downloadTimer);
      document.getElementById("timeout").innerHTML = "Oops! Times Up";
      var timer=0;
       $.ajax({
      type: 'post',
      url: "{% url 'Buyer:index' %}product/{{product.product_id}}", // this is the mapping between the url and view
      success: function(html){ location.reload()},
      data: {
        'timer': timer, // ! here is the magic, your variable gets transmitted to the server
        'csrfmiddlewaretoken': window.CSRF_TOKEN
      }});
      //window.location.reload(true);
     }
     else {
      document.getElementById("timeout").innerHTML = "You have only " + timeleft + " seconds to place bid....";
     }
     timeleft -= 1;
   }, 1000)
   
  },120000)
  };
   
   </script>
<script>
    // Set the date we're counting down to
    var endauc = "{{product.end|date:'Y-m-d H:i'}}"
    var countDownDate = new Date(endauc).getTime();
    
    // Update the count down every 1 second
    var x = setInterval(function() {
    
      // Get today's date and time
      var now = new Date().getTime();
        
      // Find the distance between now and the count down date
      var distance = countDownDate - now;
        
      // Time calculations for days, hours, minutes and seconds
      var days = Math.floor(distance / (1000 * 60 * 60 * 24));
      var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
      // Output the result in an element with id="demo"
      document.getElementById("bid_counter1").innerHTML = days + "d " + ": " + hours + "h " + ": " + minutes + "m " + ": " + seconds + "s ";
        
      // If the count down is over, write some text 
      if (distance < 0) {
        clearInterval(x);
        document.getElementById("bid_counter1").innerHTML = "Auction Ended";
        document.getElementById("form1").disabled = "true";
        document.getElementById("btn1").disabled = "true";
        document.getElementById('msg1').style.display = 'block';
        if ('{{request.user.username}}' == '{{winner}}'){
          document.getElementById('sucbtn').style.display = 'block';
        }
        else{
          document.getElementById('backbtn').style.display = 'block';
          setInterval(function(){
            
            window.location.href='{% url "Buyer:index" %}'
          },60000)
         
        }
      }
    }, 1000);
    </script>
<script>
 if ( window.history.replaceState ) {
  window.history.replaceState( null, null, window.location.href );
}
</script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
{% endblock content %}